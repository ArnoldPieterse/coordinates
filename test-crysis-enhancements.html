<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crysis-Level Enhancement System - Advanced Graphics Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #fff;
            overflow-x: hidden;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 3em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }
        @keyframes gradientShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }
        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            margin: 10px 0;
        }
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            height: calc(100vh - 200px);
        }
        .controls-panel {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .control-section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .control-section:last-child {
            border-bottom: none;
        }
        .control-section h3 {
            margin: 0 0 20px 0;
            color: #4ecdc4;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95em;
            color: #ddd;
        }
        .control-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .control-row input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
        }
        .control-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .control-row span {
            min-width: 70px;
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #4ecdc4;
        }
        input, select, button {
            padding: 10px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
        }
        button {
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: linear-gradient(45deg, #45b7d1, #4ecdc4);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
        }
        button:disabled {
            background: rgba(255,255,255,0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .button-group button {
            flex: 1;
        }
        .visualization-panel {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            box-shadow: inset 0 4px 20px rgba(0,0,0,0.5);
        }
        #canvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .stats-panel {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            min-width: 280px;
            border: 1px solid rgba(78, 205, 196, 0.3);
            backdrop-filter: blur(10px);
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-row:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: #4ecdc4;
            font-weight: 600;
        }
        .stat-value {
            color: #fff;
            font-weight: 500;
        }
        .performance-indicator {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        .performance-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        .quality-preset {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .quality-preset button {
            font-size: 0.8em;
            padding: 8px 12px;
        }
        .quality-preset button.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .material-preview {
            position: absolute;
            bottom: 25px;
            left: 25px;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            min-width: 250px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            backdrop-filter: blur(10px);
        }
        .material-preview h4 {
            margin: 0 0 15px 0;
            color: #ffc107;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .material-param {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        .material-param:last-child {
            margin-bottom: 0;
        }
        .param-label {
            color: #ffc107;
        }
        .param-value {
            color: #fff;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
            border: 2px solid rgba(78, 205, 196, 0.5);
            backdrop-filter: blur(20px);
        }
        .loading.show {
            display: block;
        }
        .spinner {
            border: 4px solid rgba(78, 205, 196, 0.3);
            border-top: 4px solid #4ecdc4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .effect-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .effect-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #4ecdc4;
        }
        .effect-toggle label {
            margin: 0;
            cursor: pointer;
        }
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .color-picker input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        @media (max-width: 1600px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            .controls-panel {
                max-height: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 Crysis-Level Enhancement System</h1>
            <p>Advanced Graphics: PBR Materials, Dynamic Lighting, Post-Processing & Shaders</p>
        </div>
        
        <div class="main-content">
            <div class="controls-panel">
                <div class="control-section">
                    <h3>⚡ Performance Control</h3>
                    <div class="quality-preset">
                        <button id="ultraBtn">Ultra</button>
                        <button id="highBtn" class="active">High</button>
                        <button id="mediumBtn">Medium</button>
                        <button id="lowBtn">Low</button>
                    </div>
                    <div class="button-group">
                        <button id="startBtn">Start Systems</button>
                        <button id="resetBtn">Reset</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🎨 PBR Materials</h3>
                    <div class="control-group">
                        <label>Material Type:</label>
                        <select id="materialType">
                            <option value="metal">Metal</option>
                            <option value="plastic">Plastic</option>
                            <option value="wood">Wood</option>
                            <option value="fabric">Fabric</option>
                            <option value="ceramic">Ceramic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Base Color:</label>
                        <div class="color-picker">
                            <input type="color" id="baseColor" value="#ffffff">
                            <span id="baseColorValue">#ffffff</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Metallic:</label>
                        <div class="control-row">
                            <input type="range" id="metallic" min="0" max="1" value="0" step="0.01">
                            <span id="metallicValue">0.00</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Roughness:</label>
                        <div class="control-row">
                            <input type="range" id="roughness" min="0" max="1" value="0.5" step="0.01">
                            <span id="roughnessValue">0.50</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Normal Strength:</label>
                        <div class="control-row">
                            <input type="range" id="normalStrength" min="0" max="2" value="1" step="0.1">
                            <span id="normalStrengthValue">1.0</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>💡 Dynamic Lighting</h3>
                    <div class="control-group">
                        <label>Light Intensity:</label>
                        <div class="control-row">
                            <input type="range" id="lightIntensity" min="0" max="2" value="1" step="0.1">
                            <span id="lightIntensityValue">1.0</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Light Color:</label>
                        <div class="color-picker">
                            <input type="color" id="lightColor" value="#ffffff">
                            <span id="lightColorValue">#ffffff</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Shadow Quality:</label>
                        <div class="control-row">
                            <input type="range" id="shadowQuality" min="512" max="4096" value="2048" step="512">
                            <span id="shadowQualityValue">2048</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Volumetric Light:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="volumetricLight" checked>
                            <label for="volumetricLight">Enable</label>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🎭 Post-Processing</h3>
                    <div class="control-group">
                        <label>Bloom:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="bloomEffect" checked>
                            <label for="bloomEffect">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Bloom Strength:</label>
                        <div class="control-row">
                            <input type="range" id="bloomStrength" min="0" max="2" value="0.5" step="0.1">
                            <span id="bloomStrengthValue">0.5</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>SSAO:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="ssaoEffect" checked>
                            <label for="ssaoEffect">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Motion Blur:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="motionBlurEffect">
                            <label for="motionBlurEffect">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Depth of Field:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="dofEffect">
                            <label for="dofEffect">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Exposure:</label>
                        <div class="control-row">
                            <input type="range" id="exposure" min="0" max="3" value="1" step="0.1">
                            <span id="exposureValue">1.0</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Contrast:</label>
                        <div class="control-row">
                            <input type="range" id="contrast" min="0.5" max="2" value="1.1" step="0.1">
                            <span id="contrastValue">1.1</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Saturation:</label>
                        <div class="control-row">
                            <input type="range" id="saturation" min="0" max="2" value="1.2" step="0.1">
                            <span id="saturationValue">1.2</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🔧 Advanced Shaders</h3>
                    <div class="control-group">
                        <label>Normal Mapping:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="normalMapping" checked>
                            <label for="normalMapping">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Parallax Occlusion:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="parallaxOcclusion">
                            <label for="parallaxOcclusion">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Tessellation:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="tessellation">
                            <label for="tessellation">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Tessellation Level:</label>
                        <div class="control-row">
                            <input type="range" id="tessellationLevel" min="1" max="8" value="4" step="1">
                            <span id="tessellationLevelValue">4</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>📊 Rendering Options</h3>
                    <div class="control-group">
                        <label>Wireframe Mode:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="wireframeMode">
                            <label for="wireframeMode">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Show Normals:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="showNormals">
                            <label for="showNormals">Enable</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Show Performance:</label>
                        <div class="effect-toggle">
                            <input type="checkbox" id="showPerformance" checked>
                            <label for="showPerformance">Enable</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization-panel">
                <canvas id="canvas"></canvas>
                
                <div class="stats-panel" id="statsPanel">
                    <div class="stat-row">
                        <span class="stat-label">FPS:</span>
                        <span class="stat-value" id="fps">60</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Frame Time:</span>
                        <span class="stat-value" id="frameTime">16.7ms</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Draw Calls:</span>
                        <span class="stat-value" id="drawCalls">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Triangles:</span>
                        <span class="stat-value" id="triangles">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Memory:</span>
                        <span class="stat-value" id="memoryUsage">0MB</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Quality:</span>
                        <span class="stat-value" id="qualityLevel">High</span>
                    </div>
                    <div class="performance-indicator">
                        <div class="performance-bar" id="performanceBar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="material-preview" id="materialPanel">
                    <h4>Material Properties</h4>
                    <div class="material-param">
                        <span class="param-label">Type:</span>
                        <span class="param-value" id="materialTypeDisplay">Metal</span>
                    </div>
                    <div class="material-param">
                        <span class="param-label">Metallic:</span>
                        <span class="param-value" id="metallicDisplay">0.00</span>
                    </div>
                    <div class="material-param">
                        <span class="param-label">Roughness:</span>
                        <span class="param-value" id="roughnessDisplay">0.50</span>
                    </div>
                    <div class="material-param">
                        <span class="param-label">Normal:</span>
                        <span class="param-value" id="normalDisplay">1.0</span>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div>Initializing Crysis Systems...</div>
                    <div style="font-size: 0.8em; margin-top: 10px;">Loading PBR, Lighting & Shaders</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from './src/three.module.js';
        import { CrysisEnhancementSystem } from './src/crysis-enhancement.js';
        import { VoxelTree } from './src/procedural-tree-voxel.js';
        import TreeOptions from './src/tree-options.js';

        // Global variables
        let scene, camera, renderer;
        let crysisSystem;
        let testObjects = [];
        let systemsRunning = false;
        let animationId;
        let lastTime = 0;
        let frameCount = 0;
        let fps = 60;
        let frameTime = 16.7;

        // Initialize Three.js scene
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            const canvas = document.getElementById('canvas');
            const aspect = canvas.clientWidth / canvas.clientHeight;
            
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.position.set(30, 25, 30);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true,
                alpha: true 
            });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // Initialize Crysis Enhancement System
            crysisSystem = new CrysisEnhancementSystem(renderer, scene, camera);

            // Create test objects
            createTestObjects();

            // Handle window resize
            window.addEventListener('resize', onWindowResize);

            animate();
        }

        function createTestObjects() {
            // Create ground plane
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = crysisSystem.createPBRMaterial({
                baseColor: 0x2a2a2a,
                metallic: 0.0,
                roughness: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Create various test objects with different materials
            const objects = [
                {
                    geometry: new THREE.SphereGeometry(5, 32, 32),
                    position: [-15, 5, 0],
                    material: 'metal'
                },
                {
                    geometry: new THREE.BoxGeometry(8, 8, 8),
                    position: [15, 5, 0],
                    material: 'plastic'
                },
                {
                    geometry: new THREE.CylinderGeometry(3, 3, 10, 32),
                    position: [0, 5, -15],
                    material: 'wood'
                },
                {
                    geometry: new THREE.TorusGeometry(4, 1, 16, 32),
                    position: [0, 5, 15],
                    material: 'ceramic'
                }
            ];

            objects.forEach((obj, index) => {
                const material = createMaterialByType(obj.material);
                const mesh = new THREE.Mesh(obj.geometry, material);
                mesh.position.set(...obj.position);
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                
                mesh.userData = {
                    id: `object_${index}`,
                    materialType: obj.material
                };
                
                scene.add(mesh);
                testObjects.push(mesh);
            });

            // Create trees with PBR materials
            createPBRTrees();
        }

        function createMaterialByType(type) {
            const materials = {
                metal: {
                    baseColor: 0x888888,
                    metallic: 1.0,
                    roughness: 0.2
                },
                plastic: {
                    baseColor: 0x4ecdc4,
                    metallic: 0.0,
                    roughness: 0.3
                },
                wood: {
                    baseColor: 0x8B4513,
                    metallic: 0.0,
                    roughness: 0.8
                },
                ceramic: {
                    baseColor: 0xffffff,
                    metallic: 0.0,
                    roughness: 0.1
                },
                fabric: {
                    baseColor: 0xff6b6b,
                    metallic: 0.0,
                    roughness: 0.9
                }
            };

            return crysisSystem.createPBRMaterial(materials[type] || materials.plastic);
        }

        function createPBRTrees() {
            const treeTypes = ['broadleaf', 'pine', 'willow'];
            const positions = [
                [-25, 0, -25], [25, 0, -25], [-25, 0, 25]
            ];

            treeTypes.forEach((type, index) => {
                const options = new TreeOptions();
                options.type = type;
                
                const tree = new VoxelTree(options);
                const treeMesh = tree.toMesh({ ringSides: 12, useHybrid: true });
                
                // Apply PBR material to tree
                const treeMaterial = crysisSystem.createPBRMaterial({
                    baseColor: type === 'broadleaf' ? 0x228B22 : 0x2E8B57,
                    metallic: 0.0,
                    roughness: 0.8
                });
                
                treeMesh.traverse(child => {
                    if (child.isMesh) {
                        child.material = treeMaterial;
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });
                
                treeMesh.position.set(...positions[index]);
                scene.add(treeMesh);
                testObjects.push(treeMesh);
            });
        }

        function onWindowResize() {
            const canvas = renderer.domElement;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            
            if (crysisSystem) {
                crysisSystem.resize(width, height);
            }
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            
            const currentTime = performance.now();
            const deltaTime = currentTime - lastTime;
            frameTime = deltaTime;
            frameCount++;
            
            if (currentTime - lastTime >= 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                frameCount = 0;
                lastTime = currentTime;
                updatePerformanceStats();
            }
            
            if (systemsRunning && crysisSystem) {
                // Update Crysis enhancement system
                crysisSystem.update(currentTime);
                
                // Animate test objects
                animateTestObjects(deltaTime);
            }
            
            // Rotate camera around scene
            const time = currentTime * 0.001;
            camera.position.x = Math.cos(time * 0.2) * 40;
            camera.position.z = Math.sin(time * 0.2) * 40;
            camera.position.y = 25 + Math.sin(time * 0.1) * 5;
            camera.lookAt(0, 0, 0);
            
            // Render with Crysis system
            if (crysisSystem) {
                crysisSystem.render();
            } else {
                renderer.render(scene, camera);
            }
        }

        function animateTestObjects(deltaTime) {
            testObjects.forEach((obj, index) => {
                obj.rotation.y += deltaTime * 0.001 * (index % 2 === 0 ? 1 : -1);
                obj.rotation.x += deltaTime * 0.0005 * Math.sin(index);
            });
        }

        function updatePerformanceStats() {
            const metrics = crysisSystem ? crysisSystem.getPerformanceMetrics() : {
                drawCalls: renderer.info.render.calls,
                triangles: renderer.info.render.triangles,
                memory: { geometries: 0, textures: 0 }
            };

            document.getElementById('fps').textContent = fps;
            document.getElementById('frameTime').textContent = frameTime.toFixed(1) + 'ms';
            document.getElementById('drawCalls').textContent = metrics.drawCalls;
            document.getElementById('triangles').textContent = metrics.triangles.toLocaleString();
            document.getElementById('memoryUsage').textContent = (metrics.memory.geometries * 0.1).toFixed(1) + 'MB';
            document.getElementById('qualityLevel').textContent = document.querySelector('.quality-preset button.active').textContent;
            
            // Update performance bar
            const performancePercent = Math.min(100, (fps / 60) * 100);
            document.getElementById('performanceBar').style.width = performancePercent + '%';
        }

        // System control functions
        function startSystems() {
            systemsRunning = true;
            document.getElementById('startBtn').disabled = true;
            console.log('Crysis enhancement systems started');
        }

        function resetSystems() {
            // Clear existing objects
            testObjects.forEach(obj => {
                if (obj.parent) obj.parent.remove(obj);
            });
            testObjects = [];
            
            // Recreate test objects
            createTestObjects();
            
            console.log('Systems reset');
        }

        // Quality preset functions
        function setQualityPreset(preset) {
            const presets = {
                ultra: { shadowQuality: 4096, tessellation: true },
                high: { shadowQuality: 2048, tessellation: false },
                medium: { shadowQuality: 1024, tessellation: false },
                low: { shadowQuality: 512, tessellation: false }
            };
            
            const presetData = presets[preset];
            if (presetData) {
                document.getElementById('shadowQuality').value = presetData.shadowQuality;
                document.getElementById('shadowQualityValue').textContent = presetData.shadowQuality;
                document.getElementById('tessellation').checked = presetData.tessellation;
                
                crysisSystem.setPerformanceMode(preset);
            }
        }

        // Material update functions
        function updateMaterial() {
            const materialType = document.getElementById('materialType').value;
            const baseColor = document.getElementById('baseColor').value;
            const metallic = parseFloat(document.getElementById('metallic').value);
            const roughness = parseFloat(document.getElementById('roughness').value);
            const normalStrength = parseFloat(document.getElementById('normalStrength').value);

            testObjects.forEach(obj => {
                if (obj.userData.materialType === materialType) {
                    const newMaterial = crysisSystem.createPBRMaterial({
                        baseColor: parseInt(baseColor.replace('#', '0x')),
                        metallic: metallic,
                        roughness: roughness
                    });
                    obj.material = newMaterial;
                }
            });

            // Update material preview
            document.getElementById('materialTypeDisplay').textContent = materialType.charAt(0).toUpperCase() + materialType.slice(1);
            document.getElementById('metallicDisplay').textContent = metallic.toFixed(2);
            document.getElementById('roughnessDisplay').textContent = roughness.toFixed(2);
            document.getElementById('normalDisplay').textContent = normalStrength.toFixed(1);
        }

        // Update all range input value displays
        function updateAllValueDisplays() {
            const ranges = document.querySelectorAll('input[type="range"]');
            ranges.forEach(range => {
                const valueSpan = document.getElementById(range.id + 'Value');
                if (valueSpan) {
                    valueSpan.textContent = parseFloat(range.value).toFixed(2);
                }
            });
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startSystems);
        document.getElementById('resetBtn').addEventListener('click', resetSystems);

        // Quality preset buttons
        document.getElementById('ultraBtn').addEventListener('click', () => setQualityPreset('ultra'));
        document.getElementById('highBtn').addEventListener('click', () => setQualityPreset('high'));
        document.getElementById('mediumBtn').addEventListener('click', () => setQualityPreset('medium'));
        document.getElementById('lowBtn').addEventListener('click', () => setQualityPreset('low'));

        // Material controls
        document.getElementById('materialType').addEventListener('change', updateMaterial);
        document.getElementById('baseColor').addEventListener('input', function() {
            document.getElementById('baseColorValue').textContent = this.value;
            updateMaterial();
        });

        // Range input event listeners
        const ranges = document.querySelectorAll('input[type="range"]');
        ranges.forEach(range => {
            range.addEventListener('input', function() {
                const valueSpan = document.getElementById(this.id + 'Value');
                if (valueSpan) {
                    valueSpan.textContent = parseFloat(this.value).toFixed(2);
                }
                
                // Update specific systems
                if (this.id === 'metallic' || this.id === 'roughness' || this.id === 'normalStrength') {
                    updateMaterial();
                }
            });
        });

        // Checkbox event listeners
        document.getElementById('showPerformance').addEventListener('change', function() {
            const statsPanel = document.getElementById('statsPanel');
            statsPanel.style.display = this.checked ? 'block' : 'none';
        });

        document.getElementById('wireframeMode').addEventListener('change', function() {
            testObjects.forEach(obj => {
                if (obj.material) {
                    obj.material.wireframe = this.checked;
                }
            });
        });

        // Initialize scene
        initScene();
        
        // Auto-start systems after initialization
        setTimeout(startSystems, 2000);
    </script>
</body>
</html> 